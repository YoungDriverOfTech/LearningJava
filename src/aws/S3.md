# S3
## Amazon S3 Use cases
- 备份和存储(Backup and storage)
- 灾难恢复(Disaster Recovery)
- 归档(Archive)
- 混合云存储(Hybrid Cloud storage)
- 应用程序托管(Application hosting)
- ...

## Buckets 桶
- s3允许人存储文件到桶里（路径）
- 桶的名字必须唯一，跨所有区，所有账户，都唯一
- 桶在region的层级被定义
- s3看起来像是全球服务，但是是在region区域内被创建的
- 命名
  - 没大写，没下划线
  - 3-36字符长度
  - 不能是ip
  - 开头必须小写或者数字
  - 开头不能是xn--
  - 结尾不能是-s3alias

## Object 文件对象
- Object有一个key
- key是一个全路径
  - s3://my-bucket/my_folder1/another_folder/my_file.txt
- key由**前缀**+***object***名字组成
  - s3://my-bucket/**my_folder1/another_folder**/***my_file.txt***
- s3里面没有文件夹的概念，只是ui展示的时候会展示成文件夹

## Object size
- 最大文件的size是5TB
- 如果文件上传的时候超过5GB，使用分段上传 multi-part upload
- Metadata，元数据（键值对集合）
- Tags 类似于lable
- Version ID，如果启用了version的功能

## Hands on
![img.png](img.png)
![img_1.png](img_1.png)
![img_2.png](img_2.png)
![img_3.png](img_3.png)
![img_4.png](img_4.png)


## Security
- 基于用户 user based
  - IAM policies 应允许特定用户从 IAM 调用哪些 API
- 基于资源 resource based
  - Bucket policies 来自 S3 控制台的存储桶范围规则 - 允许跨帐户
  - Object Access Control List(ACL) 可以被禁用
  - Bucket Access Control List(ACL) 可以被禁用
- Note: 一个IAM委托人可以访问s3文件，如果
  - 用户IAM权限允许或者资源允许
  - 并且没有明确的拒绝
- 加密
  - s3使用加密key来加密文件

## Bucket Policies
- JSON based policies
  - Resources：桶和文件（object）
  - Effect：Allow/Deny
  - Actions：允许或者拒绝API的访问
  - Principal：收policy影响账户或者用户
- 使用s3的bucket policy可以
  - 开放bucket共public使用
  - 强制object必须被加密，在上传的时候
  - 开放另一个账户的访问bucket权限

### Public Access - Use Bucket Policy
![img_5.png](img_5.png)

### User Access to S3 - IAM permissions
![img_6.png](img_6.png)

### EC2 Access to S3 - Role
![img_7.png](img_7.png)

### Cross-Account Access - Use Bucket Policy
![img_8.png](img_8.png)

### Bucket settings Block Public Access 
![img_9.png](img_9.png)
- 这些设定是用来防止公司数据泄漏
- 如果知道数据绝不是公开的，那么就开启这些设定
- 可以在账户级别设置

### 开放bucket给public
![img_10.png](img_10.png)
![img_11.png](img_11.png)
![img_12.png](img_12.png)
![img_13.png](img_13.png)
![img_14.png](img_14.png)

## S3挂载静态网页
![img_15.png](img_15.png)
![img_16.png](img_16.png)
![img_17.png](img_17.png)
![img_18.png](img_18.png)
![img_19.png](img_19.png)























